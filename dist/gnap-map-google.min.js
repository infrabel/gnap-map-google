!function(){"use strict";function a(a){function b(a,b,c,d){return{icon:b,zIndex:c.zIndex||c.minZoomLevel,title:a.getProperty("label")}}function c(){return{getStyles:function(){return d}}}var d=[],e={key:"google",displayName:"Google",coordinateSystem:"wgs84",defaults:{zoomLevel:8,center:{lat:50.762437,lng:4.245922},defaultStyleFunction:b}};a.registerMapTech(e),this.setDefaults=function(a){angular.extend(e.defaults,a)},this.setStyles=function(a){angular.isArray(a)?d=a:d.push(a)},this.$get=c}angular.module("gnapMapGoogle",["gnapMap"]).provider("mapTechGoogle",a),a.$inject=["mapTechProvider"]}(),function(){"use strict";function a(a,e,f,g,h,i){function j(a,b,c){function d(){if(L=f.getMap(),void 0!==L&&L instanceof google.maps.Map)$("#map-canvas").replaceWith(L.getDiv()),google.maps.event.trigger(L,"resize");else{var b=document.getElementById("map-canvas"),c=[google.maps.MapTypeId.ROADMAP,google.maps.MapTypeId.SATELLITE,google.maps.MapTypeId.HYBRID,google.maps.MapTypeId.TERRAIN],d=h.getStyles();angular.forEach(d,function(a){c.push(a.id)}),L=new google.maps.Map(b,{center:R.center,zoom:R.zoom,scaleControl:!0,panControl:!1,zoomControl:!0,zoomControlOptions:{position:google.maps.ControlPosition.LEFT_BOTTOM},mapTypeControlOptions:{position:google.maps.ControlPosition.RIGHT_TOP,style:google.maps.MapTypeControlStyle.DROPDOWN_MENU,mapTypeIds:c},overviewMapControl:!0,overviewMapControlOptions:{opened:!0},gestureHandling:"greedy"}),f.setMap(L),M=new google.maps.InfoWindow,a.activateDrawingMode&&(N=new google.maps.drawing.DrawingManager({drawingMode:null,drawingControl:!0,drawingControlOptions:{position:google.maps.ControlPosition.TOP_CENTER,drawingModes:[google.maps.drawing.OverlayType.POLYGON]}}),N.setMap(L),google.maps.event.addListener(N,"polygoncomplete",m)),angular.forEach(d,function(a){L.mapTypes.set(a.id,new google.maps.StyledMapType(a.style,{name:a.name}))});var e=i.get("mapTypeId");e&&L.setMapTypeId(e),google.maps.event.addListener(L,"idle",k),google.maps.event.addListener(L,"maptypeid_changed",l),google.maps.event.addListener(M,"closeclick",f.events.onInfoWindowClosed),L.data.setStyle(n),L.data.addListener("click",o),L.data.addListener("mouseover",p),L.data.addListener("mouseout",q)}}f.mapView._addGeoJsonData=t,f.mapView._removeGeoJsonData=v,f.mapView._centerOnFeature=w,f.mapView.addCustomKml=x,f.mapView.removeCustomKml=y,f.mapView.showInfoWindow=r,f.mapView.closeInfoWindow=s,f.mapView.resizeMap=z,f.mapView.activateDrawingMode=J,f.mapView.getGeoJson=K,f.mapView.viewPort.getZoomLevel=E,f.mapView.viewPort.setZoomLevel=D,f.mapView.viewPort.getCenter=B,f.mapView.viewPort.getCenterWgs84=B,f.mapView.viewPort.setCenter=A,f.mapView.viewPort.setCenterWgs84=A,f.mapView.viewPort.getBounds=F,f.mapView.viewPort.getBoundsWgs84=F,f.mapView.viewPort.setBounds=C,f.mapView.viewPort.setBoundsWgs84=C,f.mapView.viewPort.isInBounds=G,f.mapView.viewPort.containsBounds=H,f.mapView.viewPort.containsCoordinate=I,d()}function k(){e(function(){R.zoom=L.getZoom(),R.bounds=c(L.getBounds()),R.center=b(L.getCenter())}).then(function(){f.fetchAllDataInBounds()})}function l(){i.set("mapTypeId",L.getMapTypeId())}function m(a){e(function(){var b=d(a.getPath()),c=function(){a.setMap(null)};P?(P(b,c),P=null):f.events.onCustomShapeCreated(b,c),N.setDrawingMode(null)})}function n(a){var b=a.getProperty("type");if(a.getProperty("isLabel")){var c=f.dataLayers[b.replace("Label","")];return c.getLabelStyleFunction(a,c.iconUrl,null,E())}var d=f.dataLayers[b],e=d.getStyleFunction||Q.defaultStyleFunction,g=d.iconUrl;return e(a,g,d,E())}function o(a){var b=a.feature.getProperty("type"),c=a.feature.getId();f.events.onDataItemClicked(b,c)}function p(a){var b=a.feature.getProperty("info");b&&L.getDiv().setAttribute("title",b)}function q(a){L.getDiv().removeAttribute("title")}function r(a,b){M.close(),M.setPosition(a),M.setContent(b||$("#info-window").get(0)),M.open(L);var c=f.selection.type;if(c){var d=f.dataLayers[c].minZoomLevel;d&&E()<d&&(L.setCenter(a),D(d))}}function s(){M.close()}function t(a,b,c){if(a&&0!==a.features.length){var d=f.dataLayers[b],e=null;if(d.getLabelStyleFunction&&(e=angular.copy(a)),!c&&!d.moving)for(var g=a.features.length-1;g>=0;g--){var h=a.features[g],i=L.data.getFeatureById(h.id);i&&i.getProperty("type")===b&&a.features.splice(g,1)}0!==a.features.length&&L.data.addGeoJson(a),e&&u(e)}}function u(a){angular.forEach(a.features,function(a){a.properties.type+="Label",a.properties.isLabel=!0,"Point"!==a.geometry.type&&a.properties.center&&(a.geometry={type:"Point",coordinates:[a.properties.center.lng,a.properties.center.lat]}),a.id=a.id+"_label"}),L.data.addGeoJson(a)}function v(a){var b=!!f.dataLayers[a].getLabelStyleFunction;b?L.data.forEach(function(b){b.getProperty("type")!==a&&b.getProperty("type")!==a+"Label"||L.data.remove(b)}):L.data.forEach(function(b){b.getProperty("type")===a&&L.data.remove(b)})}function w(a){A(a.geometry.coordinates[1],a.geometry.coordinates[0])}function x(a){var b=new google.maps.FusionTablesLayer({query:{from:a.tableId},suppressInfoWindows:!1,clickable:a.clickable!==!1,zIndex:0});a.styles&&b.setOptions({styles:a.styles}),b.setMap(L),O[a.tableId]=b}function y(a){O[a.tableId].setMap(null),delete O[a.tableId]}function z(){google.maps.event.trigger(L,"resize")}function A(a,b){var c=Number(a),d=Number(b);isNaN(c)||isNaN(d)||L.setCenter({lat:c,lng:d})}function B(){var a=L.getCenter();return{lat:a.lat(),lng:a.lng()}}function C(a,b,c,d){L.fitBounds(new google.maps.LatLngBounds(new google.maps.LatLng(c,d),new google.maps.LatLng(a,b)))}function D(a){L.setZoom(7+Math.ceil(a/10*14))}function E(){return parseInt(10*(L.getZoom()-7)/14)}function F(a){if(a){var b=(R.bounds.neLng-R.bounds.swLng)*a,c=(R.bounds.neLat-R.bounds.swLat)*a;return{swLng:R.bounds.swLng-b,neLng:R.bounds.neLng+b,swLat:R.bounds.swLat-c,neLat:R.bounds.neLat+c}}return R.bounds}function G(a,b){var c=b||R.bounds;return a.neLat>=c.neLat&&a.neLng>=c.neLng&&a.swLat<=c.swLat&&a.swLng<=c.swLng}function H(a,b){var c=b||R.bounds;return a.neLat<=c.neLat&&a.neLng<=c.neLng&&a.swLat>=c.swLat&&a.swLng>=c.swLng}function I(a,b){var c=b||R.bounds,d=a[0],e=a[1];return e<=c.neLat&&d<=c.neLng&&e>=c.swLat&&d>=c.swLng}function J(a){N.setDrawingMode(google.maps.drawing.OverlayType.POLYGON),P=a}function K(){var b=a.defer();return L.data.toGeoJson(function(a){b.resolve(a)}),b.promise}var L,M,N,O={},P=null,Q=g.getSelectedMapTech().defaults,R={zoom:Q.zoomLevel,center:Q.center,bounds:null};return{restrict:"AE",template:'<div id="map-canvas" style="width: 100%; height: 100%"></div>',link:j,scope:{activateDrawingMode:"="}}}function b(a){return{lat:a.lat(),lng:a.lng()}}function c(a){var b=a.getNorthEast(),c=a.getSouthWest();return{neLat:b.lat(),neLng:b.lng(),swLat:c.lat(),swLng:c.lng()}}function d(a){var b="POLYGON ((";return angular.forEach(a,function(a){b+=a.lng()+" "+a.lat()+", "}),b+=a.getArray()[0].lng()+" "+a.getArray()[0].lat(),b+"))"}angular.module("gnapMapGoogle").directive("mapViewGoogle",a),a.$inject=["$q","$timeout","mapManager","mapTech","mapTechGoogle","localStorageService"]}(),function(){"use strict";function a(a,b,c){function d(b,c,d,h){function i(){}function j(a){"undefined"!=typeof a&&a.length>1&&(b.searchBoxData=[],k(a,b.searchBoxData))}function k(a){var c=b.customQuery({searchString:a});c&&"function"==typeof c.then&&c.then(function(a){b.searchBoxData=a.data.concat(b.searchBoxData)});var d={location:g,radius:"250",query:a},e=new google.maps.places.PlacesService(document.createElement("div"));e.textSearch(d,l)}function l(c,d){d===google.maps.places.PlacesServiceStatus.OK&&a(function(){for(var a=0;a<c.length;a++){var d,e=c[a];e.location?d=e.location:e.geometry.location?d=e.geometry.location:e.geometry.viewport?d=e.geometry.viewport:e.geometry.location&&(d=e.geometry.location),b.searchBoxData.push({location:d,title:e.name,type:f})}})}b.searchBoxData=[],b.searchBoxSelectedValue=null,b.searchBoxDropdownChanged=j,b.searchBoxSelectedValueChanged=e,i()}function e(a,d){if(a){if(a.type===f&&a.location)c.mapView.viewPort.setCenter(a.location.lat(),a.location.lng()),c.mapView.viewPort.setZoomLevel(6);else if(a.bounds){var e=a.bounds.neLat,g=a.bounds.neLng,h=a.bounds.swLat,i=a.bounds.swLng;c.mapFunctionIsSupported(c.mapView.viewPort.setBounds)?c.mapView.viewPort.setBounds(e,g,h,i):(c.mapView.viewPort.setCenter((e+h)/2,(g+i)/2),c.mapView.viewPort.setZoomLevel(5))}else a.type&&a.id?c.events.onDataItemClicked(a.type,a.id):a.position?(c.mapView.viewPort.setCenter(a.position.lat,a.position.lng),c.mapView.viewPort.setZoomLevel(8)):b.log("Unknown position in selected search result: "+JSON.stringify(a));d&&d(a)}}var f="Google result",g=new google.maps.LatLng(50.762437,4.245922);return{restrict:"AE",template:'<div ui-select ng-model="searchBoxSelectedValue" id="customSearchBox" theme="select2" style="min-width: 300px;" ng-change="searchBoxSelectedValueChanged(searchBoxSelectedValue, selectionCallback)">   <div ui-select-match placeholder="Search box">{{$select.selected.title || $select.selected}}</div>   <div data-refresh="searchBoxDropdownChanged($select.search)" ui-select-choices repeat="dropdownItem in searchBoxData">       <div ng-bind-html="dropdownItem.title"></div>       <small>Type: {{dropdownItem.type}}</small>   </div></div>',link:d,scope:{customQuery:"&",selectionCallback:"=?"}}}angular.module("gnapMapGoogle").directive("googleSearchbox",a),a.$inject=["$timeout","$log","mapManager"]}();