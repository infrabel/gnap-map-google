!function(){"use strict";function a(a){function b(a,b,c,d){return{icon:b,zIndex:c.zIndex||c.minZoomLevel,title:a.getProperty("label")}}function c(){return{getStyles:function(){return d}}}var d=[],e={key:"google",displayName:"Google",coordinateSystem:"wgs84",defaults:{zoomLevel:8,center:{lat:50.762437,lng:4.245922},defaultStyleFunction:b}};a.registerMapTech(e),this.setDefaults=function(a){angular.extend(e.defaults,a)},this.setStyles=function(a){angular.isArray(a)?d=a:d.push(a)},this.$get=c}angular.module("gnapMapGoogle",["gnapMap"]).provider("mapTechGoogle",a),a.$inject=["mapTechProvider"]}(),function(){"use strict";function a(a,e,f,g,h,i){function j(a,b,c){function d(){if(K=f.getMap(),void 0!==K&&K instanceof google.maps.Map)$("#map-canvas").replaceWith(K.getDiv()),google.maps.event.trigger(K,"resize");else{var b=document.getElementById("map-canvas"),c=[google.maps.MapTypeId.ROADMAP,google.maps.MapTypeId.SATELLITE,google.maps.MapTypeId.HYBRID,google.maps.MapTypeId.TERRAIN],d=h.getStyles();angular.forEach(d,function(a){c.push(a.id)}),K=new google.maps.Map(b,{center:Q.center,zoom:Q.zoom,scaleControl:!0,panControl:!1,zoomControl:!0,zoomControlOptions:{position:google.maps.ControlPosition.LEFT_BOTTOM},mapTypeControlOptions:{position:google.maps.ControlPosition.RIGHT_TOP,style:google.maps.MapTypeControlStyle.DROPDOWN_MENU,mapTypeIds:c},overviewMapControl:!0,overviewMapControlOptions:{opened:!0}}),f.setMap(K),L=new google.maps.InfoWindow,a.activateDrawingMode&&(M=new google.maps.drawing.DrawingManager({drawingMode:null,drawingControl:!0,drawingControlOptions:{position:google.maps.ControlPosition.TOP_CENTER,drawingModes:[google.maps.drawing.OverlayType.POLYGON]}}),M.setMap(K),google.maps.event.addListener(M,"polygoncomplete",m)),angular.forEach(d,function(a){K.mapTypes.set(a.id,new google.maps.StyledMapType(a.style,{name:a.name}))});var e=i.get("mapTypeId");e&&K.setMapTypeId(e),google.maps.event.addListener(K,"idle",k),google.maps.event.addListener(K,"maptypeid_changed",l),google.maps.event.addListener(L,"closeclick",f.events.onInfoWindowClosed),K.data.setStyle(n),K.data.addListener("click",o),K.data.addListener("mouseover",p),K.data.addListener("mouseout",q)}}f.mapView._addGeoJsonData=t,f.mapView._removeGeoJsonData=v,f.mapView.addCustomKml=w,f.mapView.removeCustomKml=x,f.mapView.showInfoWindow=r,f.mapView.closeInfoWindow=s,f.mapView.resizeMap=y,f.mapView.activateDrawingMode=I,f.mapView.getGeoJson=J,f.mapView.viewPort.getZoomLevel=D,f.mapView.viewPort.setZoomLevel=C,f.mapView.viewPort.getCenter=A,f.mapView.viewPort.getCenterWgs84=A,f.mapView.viewPort.setCenter=z,f.mapView.viewPort.setCenterWgs84=z,f.mapView.viewPort.getBounds=E,f.mapView.viewPort.getBoundsWgs84=E,f.mapView.viewPort.setBounds=B,f.mapView.viewPort.setBoundsWgs84=B,f.mapView.viewPort.isInBounds=F,f.mapView.viewPort.containsBounds=G,f.mapView.viewPort.containsCoordinate=H,d()}function k(){e(function(){Q.zoom=K.getZoom(),Q.bounds=c(K.getBounds()),Q.center=b(K.getCenter())}).then(function(){f.fetchAllDataInBounds()})}function l(){i.set("mapTypeId",K.getMapTypeId())}function m(a){e(function(){var b=d(a.getPath()),c=function(){a.setMap(null)};O?(O(b,c),O=null):f.events.onCustomShapeCreated(b,c),M.setDrawingMode(null)})}function n(a){var b=a.getProperty("type");if(a.getProperty("isLabel")){var c=f.dataLayers[b.replace("Label","")];return c.getLabelStyleFunction(a,c.iconUrl,null,D())}var d=f.dataLayers[b],e=d.getStyleFunction||P.defaultStyleFunction,g=d.iconUrl;return e(a,g,d,D())}function o(a){var b=a.feature.getProperty("type"),c=a.feature.getId();f.events.onDataItemClicked(b,c)}function p(a){var b=a.feature.getProperty("info");b&&K.getDiv().setAttribute("title",b)}function q(a){K.getDiv().removeAttribute("title")}function r(a,b){L.close(),L.setPosition(a),L.setContent(b||$("#info-window").get(0)),L.open(K);var c=f.selection.type;if(c){var d=f.dataLayers[c].minZoomLevel;d&&D()<d&&(K.setCenter(a),C(d))}}function s(){L.close()}function t(a,b,c,d){if(a&&0!==a.features.length){var e=f.dataLayers[b],g=null;if(e.getLabelStyleFunction&&(g=angular.copy(a)),!c&&!e.moving)for(var h=a.features.length-1;h>=0;h--){var i=a.features[h],j=K.data.getFeatureById(i.id);j&&j.getProperty("type")===b&&a.features.splice(h,1)}0!==a.features.length&&K.data.addGeoJson(a),g&&u(g),d&&d.type&&d.type===b&&d.id&&angular.forEach(a.features,function(a){a.id===d.type.charAt(0).toUpperCase()+d.type.slice(1)+"_"+d.id&&z(a.geometry.coordinates[1],a.geometry.coordinates[0])})}}function u(a){angular.forEach(a.features,function(a){a.properties.type+="Label",a.properties.isLabel=!0,"Point"!==a.geometry.type&&a.properties.center&&(a.geometry={type:"Point",coordinates:[a.properties.center.lng,a.properties.center.lat]}),a.id=a.id+"_label"}),K.data.addGeoJson(a)}function v(a){var b=!!f.dataLayers[a].getLabelStyleFunction;b?K.data.forEach(function(b){b.getProperty("type")!==a&&b.getProperty("type")!==a+"Label"||K.data.remove(b)}):K.data.forEach(function(b){b.getProperty("type")===a&&K.data.remove(b)})}function w(a){var b=new google.maps.FusionTablesLayer({query:{from:a.tableId},suppressInfoWindows:!1,clickable:a.clickable!==!1,zIndex:0});a.styles&&b.setOptions({styles:a.styles}),b.setMap(K),N[a.tableId]=b}function x(a){N[a.tableId].setMap(null),delete N[a.tableId]}function y(){google.maps.event.trigger(K,"resize")}function z(a,b){var c=Number(a),d=Number(b);isNaN(c)||isNaN(d)||K.setCenter({lat:c,lng:d})}function A(){var a=K.getCenter();return{lat:a.lat(),lng:a.lng()}}function B(a,b,c,d){K.fitBounds(new google.maps.LatLngBounds(new google.maps.LatLng(c,d),new google.maps.LatLng(a,b)))}function C(a){K.setZoom(7+Math.ceil(a/10*14))}function D(){return parseInt(10*(K.getZoom()-7)/14)}function E(a){if(a){var b=(Q.bounds.neLng-Q.bounds.swLng)*a,c=(Q.bounds.neLat-Q.bounds.swLat)*a;return{swLng:Q.bounds.swLng-b,neLng:Q.bounds.neLng+b,swLat:Q.bounds.swLat-c,neLat:Q.bounds.neLat+c}}return Q.bounds}function F(a,b){var c=b||Q.bounds;return a.neLat>=c.neLat&&a.neLng>=c.neLng&&a.swLat<=c.swLat&&a.swLng<=c.swLng}function G(a,b){var c=b||Q.bounds;return a.neLat<=c.neLat&&a.neLng<=c.neLng&&a.swLat>=c.swLat&&a.swLng>=c.swLng}function H(a,b){var c=b||Q.bounds,d=a[0],e=a[1];return e<=c.neLat&&d<=c.neLng&&e>=c.swLat&&d>=c.swLng}function I(a){M.setDrawingMode(google.maps.drawing.OverlayType.POLYGON),O=a}function J(){var b=a.defer();return K.data.toGeoJson(function(a){b.resolve(a)}),b.promise}var K,L,M,N={},O=null,P=g.getSelectedMapTech().defaults,Q={zoom:P.zoomLevel,center:P.center,bounds:null};return{restrict:"AE",template:'<div id="map-canvas" style="width: 100%; height: 100%"></div>',link:j,scope:{activateDrawingMode:"="}}}function b(a){return{lat:a.lat(),lng:a.lng()}}function c(a){var b=a.getNorthEast(),c=a.getSouthWest();return{neLat:b.lat(),neLng:b.lng(),swLat:c.lat(),swLng:c.lng()}}function d(a){var b="POLYGON ((";return angular.forEach(a,function(a){b+=a.lng()+" "+a.lat()+", "}),b+=a.getArray()[0].lng()+" "+a.getArray()[0].lat(),b+"))"}angular.module("gnapMapGoogle").directive("mapViewGoogle",a),a.$inject=["$q","$timeout","mapManager","mapTech","mapTechGoogle","localStorageService"]}(),function(){"use strict";function a(a,b,c){function d(b,c,d,h){function i(){}function j(a){"undefined"!=typeof a&&a.length>1&&(b.searchBoxData=[],k(a,b.searchBoxData))}function k(a){var c=b.customQuery({searchString:a});c&&"function"==typeof c.then&&c.then(function(a){b.searchBoxData=a.data.concat(b.searchBoxData)});var d={location:g,radius:"250",query:a},e=new google.maps.places.PlacesService(document.createElement("div"));e.textSearch(d,l)}function l(c,d){d===google.maps.places.PlacesServiceStatus.OK&&a(function(){for(var a=0;a<c.length;a++){var d,e=c[a];e.location?d=e.location:e.geometry.location?d=e.geometry.location:e.geometry.viewport?d=e.geometry.viewport:e.geometry.location&&(d=e.geometry.location),b.searchBoxData.push({location:d,title:e.name,type:f})}})}b.searchBoxData=[],b.searchBoxSelectedValue=null,b.searchBoxDropdownChanged=j,b.searchBoxSelectedValueChanged=e,i()}function e(a){if(a)if(a.type===f&&a.location)c.mapView.viewPort.setCenter(a.location.lat(),a.location.lng()),c.mapView.viewPort.setZoomLevel(6);else if(a.bounds){var d=a.bounds.neLat,e=a.bounds.neLng,g=a.bounds.swLat,h=a.bounds.swLng;c.mapFunctionIsSupported(c.mapView.viewPort.setBounds)?c.mapView.viewPort.setBounds(d,e,g,h):(c.mapView.viewPort.setCenter((d+g)/2,(e+h)/2),c.mapView.viewPort.setZoomLevel(5))}else a.type&&a.id?c.events.onDataItemClicked(a.type,a.id):a.position?(c.mapView.viewPort.setCenter(a.position.lat,a.position.lng),c.mapView.viewPort.setZoomLevel(8)):b.log("Unknown position in selected search result: "+JSON.stringify(a))}var f="Google result",g=new google.maps.LatLng(50.762437,4.245922);return{restrict:"AE",template:'<div ui-select ng-model="searchBoxSelectedValue" id="customSearchBox" theme="select2" style="min-width: 300px;" ng-change="searchBoxSelectedValueChanged(searchBoxSelectedValue)">   <div ui-select-match placeholder="Search box">{{$select.selected.title || $select.selected}}</div>   <div data-refresh="searchBoxDropdownChanged($select.search)" ui-select-choices repeat="dropdownItem in searchBoxData">       <div ng-bind-html="dropdownItem.title"></div>       <small>Type: {{dropdownItem.type}}</small>   </div></div>',link:d,scope:{customQuery:"&"}}}angular.module("gnapMapGoogle").directive("googleSearchbox",a),a.$inject=["$timeout","$log","mapManager"]}();